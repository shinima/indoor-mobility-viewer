# location-viewer 定位数据查看工具 

下面所说的*实时*其实只是指每隔一定时间调用后端(3s)接口而已

## 功能概览

该工具目前已经完成了前半部分的开发, 后面的部分就将基于已有的开发成果, 添加Koa后端, 以允许查看实时数据.

* 轨迹图相关部分
  1. 查看若干个MAC地址在一天内的轨迹概览
  2. 查看一个MAC地址一天内的轨迹列表
  3.  **查看一个MAC地址的实时轨迹(实时性取决于前端的轮询频率)**
* 热度图相关部分
  1. 查看一个楼层在某一天内不同时间段的热度情况
  2.  **查看一个楼层的实时热度情况(取决于前端的轮询频率)**

## 设计概览

目前前端所采用的框架主要为React相关类库, 后续主要添加redux-saga来进行比较复杂的数据传输. 原有的RPC打算使用websocket来增加对流数据的支持, 使用流数据来加快热度图的响应. (这部分具体的技术设计待定, 还需在仔细想想)



后端主要使用KOA搭建web服务, 同时使用ws库搭建websocket服务. 前后端通过自己封装的simple-rpc进行通信.

开发时后端从dblab-mysql中读取数据, 这样方便调试; 真正部署时, 可以部署到hzds服务器, 以读取实时数据. 定位数据可以每天定时导入一次, 即dblab-mysql中的数据将延迟一天, 后端将后台的数据手动往前拨一天, 这样对于前端来说定位数据就是实时的了.

## 新增的交互设计

新增的交互设计主要针对实时数据的处理.

轨迹图查看历史日期的数据, 会从后台一次性载入当前选择的所有mac的数据, 然后进行渲染; 如果日期切换到*今天*, 首先载入当天已有的数据, 然后进行轮询: 前端每隔3秒向后端发送数据请求, 请求最近3s时间中新增的轨迹数据.





